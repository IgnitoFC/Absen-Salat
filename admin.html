<!-- admin.html -->
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin Rekap Absen Dzuhur</title>
<style>
  body{font-family:system-ui,Arial;padding:14px;max-width:960px;margin:auto;background:#f3f6f9}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
  th{background:#f7fafc}
  .controls{display:flex;gap:8px;align-items:center;margin-bottom:10px}
</style>
</head>
<body>
<h2>Dashboard Admin â€” Rekap Absen Dzuhur</h2>
<div class="controls">
  <label>Pilih Tanggal: <input type="date" id="date" /></label>
  <button id="load">Muat Rekap</button>
  <button id="export">Export CSV</button>
</div>
<div id="tableWrap"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
/* ========== CONFIG FIREBASE - ISI DENGAN CONFIG ANDA ========== */
const firebaseConfig = {
  apiKey: "/* <-- ISI DISINI */",
  authDomain: "/* <-- ISI DISINI */",
  databaseURL: "/* <-- ISI_DISINI */",
  projectId: "/* <-- ISI DISINI */",
  storageBucket: "/* <-- ISI DISINI */",
  messagingSenderId: "/* <-- ISI DISINI */",
  appId: "/* <-- ISI DISINI */"
};
/* ============================================================ */

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

document.getElementById('date').value = new Date().toISOString().slice(0,10);
document.getElementById('load').addEventListener('click', loadData);
document.getElementById('export').addEventListener('click', exportCSV);

let currentData = [];

function loadData(){
  const tanggal = document.getElementById('date').value;
  if(!tanggal) return alert('Pilih tanggal');
  db.ref('absen/' + tanggal).get().then(snap=>{
    const val = snap.val() || {};
    currentData = [];
    for(const uid in val){
      const rec = val[uid];
      const masuk = rec.masuk || '';
      const keluar = rec.keluar || '';
      let durasi = '';
      if(masuk && keluar){
        durasi = (new Date(keluar) - new Date(masuk))/60000; // menit
        durasi = Math.round(durasi) + ' menit';
      }
      currentData.push({uid,nama:rec.nama||'',masuk,keluar,durasi});
    }
    renderTable(currentData);
  }).catch(e=>alert('Gagal muat: '+e));
}

function renderTable(data){
  if(data.length===0){ document.getElementById('tableWrap').innerHTML = '<p>Tidak ada data</p>'; return; }
  let html = '<table><thead><tr><th>UID</th><th>Nama</th><th>Masuk</th><th>Keluar</th><th>Durasi</th></tr></thead><tbody>';
  data.forEach(r=>{
    html += `<tr><td>${r.uid}</td><td>${r.nama}</td><td>${r.masuk}</td><td>${r.keluar}</td><td>${r.durasi}</td></tr>`;
  });
  html += '</tbody></table>';
  document.getElementById('tableWrap').innerHTML = html;
}

function exportCSV(){
  if(!currentData || currentData.length===0){ alert('Tidak ada data untuk diexport'); return; }
  const rows = [['UID','Nama','Masuk','Keluar','Durasi']];
  currentData.forEach(r=> rows.push([r.uid,r.nama,r.masuk,r.keluar,r.durasi]));
  const csv = rows.map(r=> r.map(cell=> `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = `rekap_absen_${document.getElementById('date').value}.csv`; a.click();
}
</script>
</body>
</html>
